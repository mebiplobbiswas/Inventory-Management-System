@model Logistic_Inventory.Models.Sales
 

@{
    var conName = @ViewContext.RouteData.Values["controller"].ToString();

    ViewBag.Title = "Sales  Details ";

    var i = 1;

    var text = " : ";
    var p = " % ";

    var server = Request.ServerVariables["SERVER_NAME"];
    string serverPort = Request.ServerVariables["SERVER_PORT"];

    var comma = ", ";


    var emailText = "Email : ";

    string ServerAddress = server;

    ViewBag.page = "sales";


    }




    <div class="card">
        <div class="card-body">




            <div class="row">

                <div class="col-md-8 ">
                    <a class="btn btn-default btn-round" href="/@conName/index"><i class="fa fa-th" aria-hidden="true"></i> &nbsp;  All Records</a>
                </div>


                <div class="col-md-4 hideSm" style="text-align:right">
                    <button class="btn btn-round btn-info" id="printNow">
                        <i class="fa fa-print"> Print</i>
                    </button>
                </div>
            </div>


            <div id="InvoiceTbl" style="font-family:sans-serif">
                <h1 style="text-align:center;margin:6px"><b>@Model.Customer.CustomerName</b></h1>

                <h4 style="text-align:center;margin-bottom:5px;font-weight:bold"> <b>@Model.Customer.Address</b> </h4>

                <h4 style="text-align:center">
                    Mobile :
                    @if (Model.Customer.Mobile != null)
                    {@Model.Customer.Mobile}

                    @{
                        if (Model.Customer.Email != null)
                        {
                            @comma @emailText @Model.Customer.Email
                        }

                    }


                </h4>


                <table class="table table-responsive  table-hover table-bordered">




                    <tr style="background:rgba(34, 42, 66, 0.075)">
                        <th colspan="4">
                            <label class="control-label">PAYMENT METHOD</label>

                            <h4> @Model.Payment_Type</h4>


                        </th>

                        <th colspan="1">
                            <label class="control-label">TOTAL AMOUNT</label>

                            <h3 style="padding:0;margin:0"><b> @Model.Total</b></h3>
                        </th>
                        <th colspan="1">
                            <label class="control-label">Invoice No</label>

                            <h4><b>@Model.Invoice</b></h4>
                        </th>

                        <th colspan="1">
                            <label class="control-label">Date</label>

                            <h4>@Model.SalesDate.Value.ToShortDateString()</h4>
                        </th>
                    </tr>



                    <tr>
                        <th>SL</th>
                        <th colspan="3">Products Descriptions</th>
                        <th class="center">Quantity</th>
                        <th class="center">Unit Price</th>
                        <th class="right">Amount Total</th>
                    </tr>


                    @{
                        var productsList = ViewData["products"] as IEnumerable<Logistic_Inventory.Models.DAO.ProductDAO>;
                    }

                    @if (Model.ProductCount == 1)
                    {
                        //total = decimal.Parse(Model.QuantityList.ToString())  *  Model.Products.SellingUnitPrice;
                        var pid = Convert.ToInt32(Model.ProductsListIds);
                        <tr>
                            <td id="NoBorder">@i</td>
                            <td colspan="3" id="NoBorder">
                                <label class="control-label">@Model.Products.ProductName </label>

                                <h6>@Model.Products.Description</h6>

                            </td>
                            <td id="NoBorder" class="center">  @decimal.Parse(Model.QuantityList.ToString()).ToString("G29") &nbsp;  @productsList.Where(s => s.Id == pid).SingleOrDefault().Unit </td>
                            <td id="NoBorder" class="center">@Model.Products.SellingUnitPrice</td>
                            <td id="NoBorder" class="right">@Model.Total</td>
                        </tr>
                    }


                    @{
                        if (Model.ProductCount > 1)
                        {
                            List<string> productList = Model.ProductsListNames.Split(',').ToList();
                            List<string> ProductsListIds = Model.ProductsListIds.Split(',').ToList();
                            List<string> priceList = Model.PriceList.Split(',').ToList();
                            List<string> quantityList = Model.QuantityList.Split(',').ToList();


                            int k = 0;
                            decimal quan = 0;
                            decimal unitPrice = 0;

                            decimal total = 0;

                            foreach (var item in productList)
                            {
                                var pid = Convert.ToInt32(ProductsListIds.ElementAt(k));
                                unitPrice = Convert.ToDecimal(priceList.ElementAt(k));
                                quan = Convert.ToDecimal(quantityList.ElementAt(k));
                                total = unitPrice * quan;

                                <tr>
                                    <td id="NoBorder">@i</td>
                                    <td colspan="3" id="NoBorder">
                                        <label class="control-label">@item  </label>

                                    </td>
                                    <td id="NoBorder" class="center">  @quan &nbsp;   @productsList.Where(s => s.Id == pid).SingleOrDefault().Unit </td>
                                    <td id="NoBorder" class="center">@unitPrice</td>
                                    <td id="NoBorder" class="right">@total</td>
                                </tr>

                                k++;
                                i++;

                            }
                        }

                    }


                    @if (Model.Comments != null)
                    {
                        <tr>
                            <td id="NoBorder"></td>
                            <td id="NoBorder" style="text-align:left;" class="text-success">
                                <i class="fa fa-info-circle"></i>  @Model.Comments



                            </td>
                            <td id="NoBorder"></td>
                            <td id="NoBorder"></td>
                            <td class="right"></td>
                        </tr>

                    }

                    <tr style="background-color: #f7f7f7">
                        <td id="NoBorder"></td>
                        <td colspan="3" id="NoBorder" style="text-align:right">
                            <p><b>Total Sale</b></p>



                        </td>
                        <td id="NoBorder"></td>
                        <td id="NoBorder"></td>
                        <td class="right"><b>@Model.Total</b></td>
                    </tr>

                    <tr>
                        <td id="NoBorder"></td>
                        <td colspan="3" id="NoBorder" style="text-align:right">
                            <p> Discount</p>



                        </td>
                        <td id="NoBorder"></td>
                        <td id="NoBorder"></td>
                        <td class="right"> - @Model.Discount  </td>
                    </tr>
                    <tr>
                        <td id="NoBorder"></td>
                        <td colspan="3" id="NoBorder" style="text-align:right">
                            <p>VAT</p>



                        </td>
                        <td id="NoBorder"></td>
                        <td id="NoBorder"></td>
                        <td class="right">@Model.VAT_Type  @Model.VAT  </td>
                    </tr>
                    <tr style="background-color:#f7f7f7;font-weight:bold">
                        <td id="NoBorder"></td>
                        <td colspan="3" id="NoBorder" style="text-align:right">
                            <p><b>Net Total</b></p>



                        </td>
                        <td id="NoBorder"></td>
                        <td id="NoBorder"></td>
                        <td class="right"><b>@Model.GrandTotal</b></td>
                    </tr>
                    <tr>
                        <td id="NoBorder"></td>
                        <td colspan="3" id="NoBorder" style="text-align:right">
                            <p><b>Amount Paid</b> </p>



                        </td>
                        <td id="NoBorder"></td>
                        <td id="NoBorder"></td>
                        <td class="right">  @Model.Paid  </td>
                    </tr>

                    <tr>
                        <td id="NoBorder"></td>
                        <td colspan="3" id="NoBorder" style="text-align:right">
                            <p> <b>Amount Due</b></p>



                        </td>
                        <td id="NoBorder"></td>
                        <td id="NoBorder"></td>
                        <td class="right"> @Model.Due </td>
                    </tr>




                    <tr id="BorderTop">
                        <td id="BorderTop"> </td>
                        <td colspan="3" id="BorderTop">
                            <h4><b>Net Receivable Amount</b> </h4>



                        </td>
                        <td id="BorderTop"></td>
                        <td id="BorderTop"></td>
                        <td id="BorderTop" class="right"><b style="border-bottom:1px solid black;font-size:20px">@Model.Total</b></td>
                    </tr>



                </table>
            </div>






            <style>
                #NoBorder {
                    border-bottom: 1px solid #f5f6fa;
                }

                #BorderTop {
                    border-top: 1px solid grey;
                }

                .center {
                    text-align: center;
                }

                .right {
                    text-align: right;
                }
            </style>


            <script>
                var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
                if (width < 900) {
                    $("table").addClass("table-responsive");
                }


                $("#printNow").click(function () {

                    var toPrint = document.getElementById('InvoiceTbl');

                    var popupWin = window.open('', '', 'toolbar=yes,scrollbars=yes,resizable=yes,width=1000,height=800,location=no,left=200px');
                    popupWin.document.open();
                    popupWin.document.write('<html><head><title>SALE </title><style>h1{font-size:20px} h4{font-size:14px}  .no-print{display: none;} .table > thead > tr > th, .table > tbody > tr > th, .table > tfoot > tr > th, .table > thead > tr > td, .table > tbody > tr > td, .table > tfoot > tr > td{ }a[href]:after {content: none !important;}      </style> <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" />  <link href="/Content/site.css" rel="stylesheet"/></head>');

                    popupWin.document.write('<body onload="window.print();" style="padding:1%"> <div >  ');

                    popupWin.document.write('<table class="table table-responsive  table-hover table-bordered" style="font-size:12px" id="print">');
                    popupWin.document.write(toPrint.innerHTML);
                    popupWin.document.write('</table>');


                    popupWin.document.write('</div></body></html>');
                    popupWin.document.close();

                    //var divToPrint = document.getElementById("InvoiceTbl");
                    //newWin = window.open('', '', 'toolbar=yes,scrollbars=yes,resizable=yes,width=800,height=800,location=no,left=200px');;
                    //newWin.document.write(divToPrint.outerHTML);
                    //newWin.print();


                });

            </script>


        </div>

    </div>
